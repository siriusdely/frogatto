{
id: "bunny_ball_tosser",
hitpoints: 800,
prototype: ["hittable"],
always_active: true,

properties: {
	flinch_threshold: 1000,
	physical_size: "int :: 64",
	team: "'evil'",
	basic_type: "me.type",
	frogourmet_tag: "me.basic_type",
	handle_knockback: "def(obj hittable collide_with) -> commands null",

	taxonomy: "'milgramen'",
	acquirable_item_drop_value: "25",					
	points_value: "27",
	
	charge_time: "2",
	_charge_counter: { type: "int", default: 0, persistent: false },
	
	ammo_stack: { type: "obj bunny_ball_tosser.cannonball_pile", init: "object('bunny_ball_tosser.cannonball_pile', img_mid_x + 64 * facing, img_mid_y + 36, {facing: facing})" },
},
on_create: "if(lower_difficulty, set(max_hitpoints, 400))",
on_start_level: "add_object(ammo_stack)",
on_end_stand_anim: "[add(_charge_counter, 1), if(_charge_counter >= charge_time, set(animation, 'throw'), set(animation, 'stand'))]",
on_end_throw_anim: "[set(_charge_counter, 0), set(animation, 'stand')]",
on_die: "remove_object(ammo_stack)",
on_end_hurt_anim: "animation('normal')",
on_launch_ball: "spawn('bunny_ball_tosser.thrown_metal_ball', midpoint_x, y, facing, [set(child.velocity_x, -facing*600-1d200),set(child.velocity_y, -400)])",

on_whoosh: "sound('weapon-swing-hard'+1d3+'.wav')",

solid_area: [20,18,42,56],
editor_info: {
	category: "enemies, milgramen",
},
animation: [
	{
		image: "enemies/bunny-ball-tosser.png",
		pad: 3,
		accel_y: 80,
		accel_x: 0,
		body_area: "all",
		id: "stand",
		duration: 4,
		frames: 3,
		frames_per_row: 1,
		rect: [1,1,62,62],
		reverse: true,
	},
	{
		image: "enemies/bunny-ball-tosser.png",
		pad: 3,
		accel_y: 80,
		accel_x: 0,
		body_area: "all",
		id: "hurt",
		duration: 4,
		frames: 3,
		frames_per_row: 1,
		rect: [1,1,62,62],
		reverse: true,
	},
	{
		image: "enemies/bunny-ball-tosser.png",
		pad: 3,
		accel_y: 80,
		accel_x: 0,
		body_area: "all",
		id: "throw",
		duration: 5,
		frames: 12,
		frames_per_row: 4,
		rect: [98,1,198,66],
		reverse: false,
		solid_area: [40,22,62,60],
		events: "35:whoosh,42:launch_ball",
	},
],
object_type: [
	{
		id: "cannonball_pile",
		zorder: "@include data/zorder.cfg:interior_decor",
		animation: {
			id: "normal",
			image: "enemies/bunny-ball-tosser.png",
			rect: [66,1,94,27],
			pad: 4,
		},
	},
	{
		id: "thrown_metal_ball",
		prototype: ["throwable_projectile"],
		friction: 0000,
		traction: 0000,
		always_active: true,
		hitpoints: 32,
		solid_area: [4,4,8,8],
		properties: {
			attack_damage: "if(team='evil', 2, 400)",
			damage_cooldown: 5,
			soundname: "'metal-ball-bounce'+1d3+'.wav'",
			thump: "def(decimal speed) -> commands sound(soundname, lib.math.constrain(0, 300.0/lib.math.length(self, level.player)*max(0, abs(speed)-140)/1000.0, 10))",
		},
		on_create: "set(fall_through_platforms,-1)",
		on_collide_side: "[	add(hitpoints, -1), set(velocity_x, -(velocity_x*95)/100), impact_cloud_silent(x2,mid_y,'small'), thump(velocity_x)]",
		on_collide_feet: "[	add(hitpoints, -1), impact_cloud_silent(mid_x,y2,'small'), set(velocity_y, -(velocity_y*7)/10), thump(velocity_y)]",
		on_collide_head: "[	set(velocity_y, -velocity_y), impact_cloud_silent(mid_x,y,'small'), thump(velocity_y)]",
		

		on_spat: "[proto_event('throwable_projectile', 'spat'), set(accel_y, 80),set(fall_through_platforms,0),set(velocity_x,velocity_x/2)]",
		animation: {
			id: "thrown",
			image: "enemies/bunny-ball-tosser.png",
			duration: 400,
			frames: 1,
			frames_per_row: 1,
			pad: 0,
			rect: [66,31,80,45],
			accel_y: 30,
			thrown_area: "all",
			body_area: "all",
		},
	},
],
}
