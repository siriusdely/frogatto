{
id: "spitting_flower",
prototype: ["stationary_vulnerable"],
hitpoints: 100,
//TODO: remove their feet once we've corrected the issue with frogatto getting semi-stuck when standing on them.
feet_width: 4,
has_feet: true,
solid_area: [12,6,24,30],

editor_info: {
	category: "enemies, seaside",
},

properties: {
	handle_knockback: "def(obj hittable collide_with) -> commands null",
	points_value: "3",
	_load: {type: "int", default: 0, persistent: false },
	_loading_time: "3",
},

on_pop: "sound('flowerpop'+1d5+'.wav')",
on_end_normal_anim: "if(_load >= _loading_time, [animation('fire'), set(_load, 0)], [animation('normal'), add(_load, 1)])",
on_end_spring_anim: "animation('normal')",
on_end_fire_anim: "animation('normal')",
on_end_dying_anim: "animation('dead')",
on_end_dead_anim: "animation('respawn')",
on_end_respawn_anim: "animation('normal')",

on_shoot: "fire_event(if(facing_towards_player = facing and higher_difficulty, 'aimed_shot', 'normal_shot'))",
on_aimed_shot: "[spawn('spitting_flower.pollen_ball', midpoint_x+ facing*50, midpoint_y -15, facing, 
					[set(child.velocity_x,velx*facing), 
					set(child.accel_y, ac_y)]),
					sound('FlowerShot.ogg')]
					where velx = ((level.player.mid_x - me.mid_x))*facing*1.54
					where ac_y = ((level.player.mid_y - me.mid_y)/15)",
on_normal_shot: "[spawn('spitting_flower.pollen_ball', midpoint_x+ facing*50, midpoint_y -15, facing, set(child.velocity_x,800*facing)),sound('FlowerShot.ogg')]",

on_die: "[death_effects('medium'), set(hitpoints, max_hitpoints), animation('dying')]",

animation: [
	{
		image: "enemies/spittingflower.png",
		pad: 3,
		accel_y: 80,
		body_area: "all",
		id: "normal",
		rect: [1,1,43,37],
		frames: 3,
		duration: 5,
		duplicates: 5,
		reverse: true,
	},
	{
		image: "enemies/spittingflower.png",
		pad: 3,
		accel_y: 80,
		body_area: "all",
		id: "normal",
		rect: [139,1,181,37],
		frames: 3,
		duration: 5,
		reverse: true,
	},

	#the spring animation is a duplicate of the normal animation,
	#unless/until we have a proper one.
	{
		image: "enemies/spittingflower.png",
		pad: 3,
		accel_y: 80,
		body_area: "all",
		id: "spring",
		rect: [1,1,43,37],
		frames: 3,
		frames_per_row: 1,
		reverse: true,
		duration: 5,
	},
	{
		image: "enemies/spittingflower.png",
		pad: 3,
		accel_y: 80,
		body_area: "all",
		id: "fire",
		rect: [1,161,43,197],
		frames: 6,
		duration: 4,
		events: "20:shoot",
	},
	{
		image: "enemies/spittingflower.png",
		pad: 3,
		accel_y: 80,
		body_area: "all",
		id: "hurt",
		rect: [1,121,43,157],
		frames: 7,
		duration: 4,
	},
	{
		image: "enemies/spittingflower.png",
		pad: 3,
		accel_y: 80,
		body_area: null,
		id: "dying",
		rect: [1,201,43,237],
		frames: 3,
		duration: 8,
	},
	{
		image: "enemies/spittingflower.png",
		pad: 3,
		accel_y: 80,
		body_area: null,
		id: "dead",
		rect: [139,201,181,237],
		frames: 1,
		duration: 300,
	},
	{
		image: "enemies/spittingflower.png",
		pad: 3,
		accel_y: 80,
		body_area: null,
		id: "respawn",
		rect: [1,41,43,77],
		frames: 7,
		duration: 6,
		events: "27:pop",
	},
],

object_type: [
	{
		id: "pollen_ball",
		always_active: true,
		affected_by_currents: true,
		object_level_collisions: true,
		prototype: ["shot"],
		on_create: "add_particles('particles')",
		on_die: "spawn('pollen_impact_particle', midpoint_x, midpoint_y, 0)",
		on_timer: "[set(rotate, cycle*10)]",
		timer_frequency: 4,
		on_end_anim: "die()",
		on_enter_water: "die()",
		animation: {
			id: "normal",
			image: "enemies/shooting-plant.png",
			rect: [90,2,100,12],
			frames: 1,
			duration: 250,
			body_area: "all",
			attack_area: "all",
		},
		particle_system: {
			id: "particles",
			type: "point",
			generation_rate_millis: 250,
			dot_size: 3,
			dot_rounded: true,
			time_to_live: 12,
			time_to_live_rand: 24,
			colors: ["f9f9dbff","ffc20eff","ffc20eaa","ff7e00aa","ae4a2855"],
			pos_x: 5,
			pos_y: 5,
			velocity_x: -1500,
			velocity_x_rand: 3000,
			velocity_y: -1500,
			velocity_y_rand: 3000,
		},
	},

],
}
